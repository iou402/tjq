require=function e(i,o,c){function n(s,a){if(!o[s]){if(!i[s]){var r="function"==typeof require&&require;if(!a&&r)return r(s,!0);if(t)return t(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=o[s]={exports:{}};i[s][0].call(h.exports,function(e){var o=i[s][1][e];return n(o?o:e)},h,h.exports,e,i,o,c)}return o[s].exports}for(var t="function"==typeof require&&require,s=0;s<c.length;s++)n(c[s]);return n}({dian:[function(e,i,o){"use strict";cc._RFpush(i,"4358f3E93FJlIBKU46lQOSf","dian"),cc.Class({"extends":cc.Component,properties:{x:0,y:0},onLoad:function(){},init:function(e,i,o){this.node.setPosition(e,i),this.x=e,this.y=i,this.index=o,console.log("init dian",o)},onclick:function(e){console.log(this.x,this.y),cc.qiChoose&&cc.cli.move(cc.qiChoose.index,this.index)}}),cc._RFpop()},{}],qz:[function(e,i,o){"use strict";cc._RFpush(i,"76b12ERTVdHHr7yWGDqqK9B","qz"),cc.Class({"extends":cc.Component,properties:{belong:0,black:cc.SpriteFrame,white:cc.SpriteFrame,index:0,newPos:[]},init:function(e,i,o,c,n){this.belong=e,this.node.setPosition(i,o),n?this.node.getChildByName("qz").getComponent(cc.Sprite).spriteFrame=this.white:this.node.getChildByName("qz").getComponent(cc.Sprite).spriteFrame=this.black,this.index=c},upBelong:function(e,i){this.belong=e,i?this.node.getChildByName("qz").getComponent(cc.Sprite).spriteFrame=this.white:this.node.getChildByName("qz").getComponent(cc.Sprite).spriteFrame=this.black},uppos:function(e,i){this.index=i,this.newPos=e,cc.qiChoose=null,this.node.getChildByName("tips").active=!1},onLoad:function(){},onclick:function(e){cc.vv.op==cc.myInfo.id&&this.belong==cc.myInfo.id&&(cc.qiChoose&&(cc.qiChoose.node.getChildByName("tips").active=!1),this.node.getChildByName("tips").active=!0,cc.qiChoose=this)},update:function(e){if(this.newPos.hasOwnProperty("x")){var i=cc.moveTo(1,cc.p(this.newPos.x,this.newPos.y));this.node.runAction(cc.sequence(i,cc.blink(3,5)))}this.newPos=[]}}),cc._RFpop()},{}],socket:[function(e,i,o){"use strict";cc._RFpush(i,"fdf0dBEOBZGj4TYoPaYA6UN","socket"),cc.Class({"extends":cc.Component,statics:{ip:"",cli:null,handlers:{},data:null,callBack:null,connect:function(){console.log("init connect",this.data);var e=this;this.cli=new WebSocket(this.ip),this.cli.onopen=function(i){console.log("Client onopen"),e.data&&(console.log("send data:",e.data),e.cli.send(e.data),e.data=null)},this.cli.onmessage=function(i){var o=JSON.parse(i.data.trimRight("\r\n"));console.log("Client received a message",o),e.callback(o)},this.cli.onclose=function(i){e.cli=null,console.log("Client notified socket has closed",i),e.connect()},this.cli.onerror=function(i){e.cli=null,console.log("Client notified socket has onerror",i.data)}},send:function(e){return e=JSON.stringify(e)+"\r\n",this.cli&&this.cli.readyState===WebSocket.OPEN?(this.cli.send(e),void console.log("send data:",e)):(this.data=e,void(null===this.cli&&this.connect()))},login:function(e){if(e)var i={cmd:5,data:{mapId:1,code:e}};else var i={cmd:1,data:{mapId:1,mid:cc.myInfo.id}};this.send(i)},move:function(e,i){var o={cmd:2,data:{pos1:e,pos2:i}};this.send(o)},changeTable:function(){var e={cmd:4};this.send(e)}}}),cc._RFpop()},{}],tjqroom:[function(e,i,o){"use strict";function c(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(i);return null!=o?unescape(o[2]):null}cc._RFpush(i,"b61d0+6SAdMHrcV9F+noaX+","tjqroom");e("dian"),e("qz");cc.Class({"extends":cc.Component,properties:{other:cc.Node,myself:cc.Node,qipan:cc.Node,dian:cc.Prefab,qi:cc.Prefab},onLoad:function(){var i=this;cc.vv=cc.aQi={},this.drawXian(),this.drawDian(),cc.cli=e("socket"),cc.cli.ip="ws://59.110.154.2:6801/",cc.cli.callback=function(e){i.onRecv(e)};var o=e("user");cc.myInfo=new o;var n=c("code");n?cc.cli.login(n):((cc.myInfo.id=cc.sys.localStorage.getItem("mid"))||(cc.myInfo.id=parseInt(1e6*Math.random()+1e4,10),cc.sys.localStorage.setItem("mid",cc.myInfo.id)),cc.cli.login())},onRecv:function(i){if(i&&i.cmd){var o=i.data;switch(i.cmd){case 11:break;case 12:if(cc.myInfo.id==o.mid)cc.myInfo.init(o),this.setSeat(1,o);else{var c=e("user");cc.otherInfo=new c,cc.otherInfo.init(o),this.setSeat(2,o)}break;case 13:this.node.getChildByName("optext").active=!1;for(var n in cc.aQi)cc.aQi[n]&&cc.aQi[n].destroy();cc.aQi={},this.node.getChildByName("next").active=!1;for(var n=0;n<o.info.length;n++)this.initQi(o.info[n]);"black"==cc.myInfo.userInfo.role&&(this.qipan.rotationX=180);break;case 14:cc.vv.op=o.op,this.node.getChildByName("optext").getComponent(cc.Label).string=cc.vv.op==cc.myInfo.id?"轮到你操作了":"对方思考中",this.node.getChildByName("optext").active=!0;break;case 15:this.node.getChildByName("optext").active=!1,cc.aQi[o.pos1]?(cc.aQi[o.pos2]=cc.aQi[o.pos1],cc.aQi[o.pos1].getComponent("qz").uppos(this.getPosXY(this.posToXY(o.pos2)),o.pos2),cc.aQi[o.pos1]=null):console.log("棋子不存在 ");break;case 16:var n=0;this.schedule(function(){console.log("chi",n,o.info[n]),this.chi(o.mid,o.info[n]),n++},1,o.info.length-1,2);break;case 17:this.node.getChildByName("optext").getComponent(cc.Label).string=o.win==cc.myInfo.id?"哈哈， 老子就是牛气, 赢了 ":"少年，还需要多吃点呀，输了 ",this.node.getChildByName("optext").active=!0,this.node.getChildByName("next").active=!0;break;case 21:var t=o.mid,c=t==cc.myInfo.id?this.myself:this.other;c.active=!1;break;case 22:o.mid?cc.myInfo.id=o.mid:alert("登录失败");break;case 23:this.myself.active=!1,this.other.active=!1;for(var n in cc.aQi)cc.aQi[n].destroy();cc.aQi={}}}},chi:function(e,i){var o=e==cc.myInfo.id?cc.myInfo:cc.otherInfo,c="white"==o.userInfo.role;console.log("chi",e,i,c,o.userInfo.role);for(var n=0;n<i.cpos.length;n++){var t=i.cpos[n];cc.aQi[t]&&cc.aQi[t].getComponent("qz").upBelong(e,c)}},changeTable:function(){cc.cli.changeTable()},drawXian:function(){var e=100,i=this.qipan.getChildByName("xian").getComponent(cc.Graphics);i.lineJoin=cc.Graphics.LineJoin.ROUND,i.moveTo(-2*e,2*e),i.lineTo(2*e,2*e),i.lineTo(2*e,-2*e),i.lineTo(-2*e,-2*e),i.lineTo(-2*e,2*e),i.lineTo(2*e,-2*e),i.moveTo(2*e,2*e),i.lineTo(-2*e,-2*e),i.moveTo(-2*e,1*e),i.lineTo(2*e,1*e),i.moveTo(-2*e,-1*e),i.lineTo(2*e,-1*e),i.moveTo(-2*e,0),i.lineTo(2*e,0),i.moveTo(1*e,-2*e),i.lineTo(1*e,2*e),i.moveTo(-1*e,-2*e),i.lineTo(-1*e,2*e),i.moveTo(0,-2*e),i.lineTo(0,2*e),i.moveTo(0,-2*e),i.lineTo(2*e,0),i.lineTo(0,2*e),i.lineTo(-2*e,0),i.lineTo(0,-2*e),i.stroke()},drawDian:function(){var e,i,o=this.qipan.getChildByName("xian").getComponent(cc.Graphics);o.fillColor=cc.color(0,0,0);for(var c=0;c<25;c++){var n=this.getPosXY(this.iToXY(c));e=n.x,i=n.y,o.circle(e,i,6),o.circle(e,i,3);var t=cc.instantiate(this.dian);t.parent=this.qipan,t.getComponent("dian").init(e,i,this.getPos(c))}o.stroke()},initQi:function(e){var i=e.chess,o=e.mid,c=o==cc.myInfo.id?cc.myInfo:cc.otherInfo;c.userInfo.role=e.role;for(var n=0;n<i.length;n++){var t=cc.instantiate(this.qi),s=this.getPosXY(this.posToXY(i[n]));t.parent=this.qipan,t.getComponent("qz").init(o,s.x,s.y,i[n],"white"==e.role),cc.aQi[i[n]]=t}},posToXY:function(e){var i=(65280&e)>>8,o=255&e;return{x:i-1,y:o-1}},iToXY:function(e){var i=parseInt(e/5),o=e%5;return{x:i,y:o}},getPos:function(e){var i=this.iToXY(e);return i.x+1<<8|i.y+1},getPosXY:function(e){var i=100,o=e.x*i-2*i,c=e.y*i-2*i;return{x:o,y:c}},setSeat:function(e,i){var o=1==e?this.myself:this.other;o.active=!0,console.log(o),o.getChildByName("mick").getComponentInChildren(cc.Label).string=i.mick,i.micon&&(i.micon=i.micon+"?.jpg",cc.loader.load(i.micon,function(e,i){var c=new cc.SpriteFrame(i,cc.Rect(0,0,88,88));o.getChildByName("micon").getChildByName("micon").getComponent(cc.Sprite).spriteFrame=c}))},update:function(e){}}),cc._RFpop()},{dian:"dian",qz:"qz",socket:"socket",user:"user"}],user:[function(e,i,o){"use strict";cc._RFpush(i,"9af1bqrw/ZMua1DLqD/JrAP","user"),cc.Class({"extends":cc.Component,properties:{id:null,userInfo:{"default":{}}},init:function(e){for(var i in e)this.userInfo[i]=e[i]}}),cc._RFpop()},{}]},{},["dian","qz","socket","tjqroom","user"]);